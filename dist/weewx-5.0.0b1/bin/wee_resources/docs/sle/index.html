
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Tom Keffer <tkeffer@gmail.com>">
      
      
        <link rel="canonical" href="https://www.weewx.com/sle/">
      
      
      
      <link rel="icon" href="../images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.9">
    
    
      
        <title>Writing search list extensions - weewx documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.85bb2934.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.a6bdf11c.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans:300,300i,400,400i,700,700i%7CInconsolata+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Noto Sans";--md-code-font:"Inconsolata Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/weewx_ui.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="white">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#writing-search-list-extensions" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="weewx documentation" class="md-header__button md-logo" aria-label="weewx documentation" data-md-component="logo">
      
  <img src="../images/logo-weewx.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            weewx documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Writing search list extensions
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="white"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/weewx/weewx" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    WeeWX GitHub Repository
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="weewx documentation" class="md-nav__button md-logo" aria-label="weewx documentation" data-md-component="logo">
      
  <img src="../images/logo-weewx.png" alt="logo">

    </a>
    weewx documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/weewx/weewx" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    WeeWX GitHub Repository
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../quickstarts/">Quick starts</a>
          
            <label for="__nav_1">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Quick starts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../quickstarts/debian/" class="md-nav__link">
        Debian
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../quickstarts/redhat/" class="md-nav__link">
        RedHat
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../quickstarts/suse/" class="md-nav__link">
        SuSE
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../quickstarts/pip/" class="md-nav__link">
        pip
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../quickstarts/v5-upgrade/" class="md-nav__link">
        Migrating to V5
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../usersguide/">User's guide</a>
          
            <label for="__nav_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          User's guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../usersguide/system-requirements/" class="md-nav__link">
        System requirements
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../usersguide/installing-weewx/" class="md-nav__link">
        Installing WeeWX
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../usersguide/where/" class="md-nav__link">
        Where to find things
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../usersguide/running-weewx/" class="md-nav__link">
        Running WeeWX
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../usersguide/webserver-integration/" class="md-nav__link">
        Web server integration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../usersguide/backing-up-weewx/" class="md-nav__link">
        Backup & restore
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../usersguide/mysql-mariadb-config/" class="md-nav__link">
        Configuring MySQL
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../usersguide/troubleshooting-guide/" class="md-nav__link">
        Troubleshooting
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_10" >
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../usersguide/weewx-config-file/">Reference: options</a>
          
            <label for="__nav_2_10">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_10_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_10">
          <span class="md-nav__icon md-icon"></span>
          Reference: options
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../usersguide/weewx-config-file/general/" class="md-nav__link">
        General options
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../usersguide/weewx-config-file/stations-config/" class="md-nav__link">
        [Station]
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../usersguide/weewx-config-file/stdrestful-config/" class="md-nav__link">
        [StdRESTful]
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../usersguide/weewx-config-file/stdreport-config/" class="md-nav__link">
        [StdReport]
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../usersguide/weewx-config-file/stdconvert-config/" class="md-nav__link">
        [StdConvert]
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../usersguide/weewx-config-file/stdcalibrate-config/" class="md-nav__link">
        [StdCalibrate]
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../usersguide/weewx-config-file/stdqc-config/" class="md-nav__link">
        [StdQC]
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../usersguide/weewx-config-file/stdwxcalculate-config/" class="md-nav__link">
        [StdWXCalculate]
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../usersguide/weewx-config-file/stdarchive/" class="md-nav__link">
        [StdArchive]
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../usersguide/weewx-config-file/stdtimesynch/" class="md-nav__link">
        [StdTimeSynch]
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../usersguide/weewx-config-file/data-bindings/" class="md-nav__link">
        [DataBindings]
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../usersguide/weewx-config-file/databases/" class="md-nav__link">
        [Databases]
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../usersguide/weewx-config-file/databasetypes/" class="md-nav__link">
        [DatabaseTypes]
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../usersguide/weewx-config-file/engine/" class="md-nav__link">
        [Engine]
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../custom/">Customization guide</a>
          
            <label for="__nav_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Customization guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../custom/custom_reports/" class="md-nav__link">
        Customizing reports
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../custom/cheetah/" class="md-nav__link">
        The Cheetah generator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../custom/image_generator/" class="md-nav__link">
        The Image generator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../custom/multiple_bindings/" class="md-nav__link">
        Multiple data bindings
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../custom/localization/" class="md-nav__link">
        Localization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../custom/service_engine/" class="md-nav__link">
        Customizing the service engine
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../custom/database/" class="md-nav__link">
        Customizing the database
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../custom/units/" class="md-nav__link">
        Customizing units
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../custom/derived/" class="md-nav__link">
        Derived types
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../custom/drivers/" class="md-nav__link">
        Custom drivers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../custom/extensions/" class="md-nav__link">
        Extensions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../custom/options_ref/" class="md-nav__link">
        Reference: options
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../custom/appendix/" class="md-nav__link">
        Appendix
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../utilities/">Utilities</a>
          
            <label for="__nav_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Utilities
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../weectl/">weectl</a>
          
            <label for="__nav_4_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          weectl
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../weectl/station/" class="md-nav__link">
        weectl station
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../weectl/extension/" class="md-nav__link">
        weectl extension
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utilities/utilities.htm#wee_database_utility" class="md-nav__link">
        wee_database
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utilities/utilities.htm#wee_debug_utility" class="md-nav__link">
        wee_debug
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utilities/utilities.htm#wee_device_utility" class="md-nav__link">
        wee_device
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utilities/utilities.htm#wee_import_utility" class="md-nav__link">
        wee_import
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utilities/utilities.htm#wee_reports_utility" class="md-nav__link">
        wee_reports
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utilities/utilities.htm#weewxd" class="md-nav__link">
        weewxd
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../upgrading.htm" class="md-nav__link">
        Upgrade guide
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../hardware.htm" class="md-nav__link">
        Hardware guide
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../devnotes/" class="md-nav__link">
        Notes for developers
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../hardware.htm" class="md-nav__link">
        Hardware comparison
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../changes/" class="md-nav__link">
        Change log
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../support/" class="md-nav__link">
        Support
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-the-search-list-works" class="md-nav__link">
    How the search list works
  </a>
  
    <nav class="md-nav" aria-label="How the search list works">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how_tags_work" class="md-nav__link">
    A simple tag
  </a>
  
    <nav class="md-nav" aria-label="A simple tag">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#return-value" class="md-nav__link">
    Return value
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#A_slightly_more_complex_tag" class="md-nav__link">
    A slightly more complex tag
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extending_the_list" class="md-nav__link">
    Extending the list
  </a>
  
    <nav class="md-nav" aria-label="Extending the list">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-tag-seven_day" class="md-nav__link">
    Adding tag $seven_day
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-tag-colorize" class="md-nav__link">
    Adding tag $colorize
  </a>
  
    <nav class="md-nav" aria-label="Adding tag $colorize">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-very-simple-implementation" class="md-nav__link">
    A very simple implementation
  </a>
  
    <nav class="md-nav" aria-label="A very simple implementation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#registering" class="md-nav__link">
    Registering
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#where-is-get_extension_list" class="md-nav__link">
    Where is get_extension_list()?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#review" class="md-nav__link">
    Review
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#limitation" class="md-nav__link">
    Limitation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-slightly-better-version" class="md-nav__link">
    A slightly better version
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-more-sophisticated-version" class="md-nav__link">
    A more sophisticated version
  </a>
  
    <nav class="md-nav" aria-label="A more sophisticated version">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#annotated-code" class="md-nav__link">
    Annotated code
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="writing-search-list-extensions">Writing search list extensions<a class="headerlink" href="#writing-search-list-extensions" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>The intention of this document is to help you write new Search List
Extensions (SLE). Here's the plan:</p>
<ul>
<li>
<p>We start by explaining how SLEs work.</p>
</li>
<li>
<p>Then we will look at an example that implements an extension
    <code>$seven_day()</code>.</p>
</li>
<li>
<p>Then we will look at another example, <code>$colorize()</code>, which
    allows you to pick background colors on the basis of a value (for
    example, low temperatures could show blue, while high temperatures
    show red). It will be implemented using 3 different, increasingly
    sophisticated, ways:</p>
</li>
<li>
<ul>
<li>A simple, hardwired version that works in only one unit system.</li>
<li>A version that can handle any unit system, but with the colors
    still hardwared.</li>
<li>Finally, a version that can handle any unit system, and takes
    its color bands from the configuration file.</li>
</ul>
</li>
</ul>
<h2 id="how-the-search-list-works">How the search list works<a class="headerlink" href="#how-the-search-list-works" title="Permanent link">&para;</a></h2>
<p>Let's start by taking a look at how the Cheetah search list works.</p>
<p>The Cheetah template engine finds tags by scanning a search list, a
Python list of objects. For example, for a tag <code>$foo</code>, the
engine will scan down the list, trying each object in the list in turn.
For each object, it will first try using <code>foo</code> as an attribute,
that is, it will try evaluating <code>obj.foo</code>. If that raises an
<code>AttributeError</code> exception, then it will try <code>foo</code> as a
key, that is <code>obj[key]</code>. If that raises a <code>KeyError</code>
exception, then it moves on to the next item in the list. The first
match that does not raise an exception is used. If no match is found,
Cheetah raises a <code>NameMapper.NotFound</code> exception.</p>
<h3 id="how_tags_work">A simple tag<a class="headerlink" href="#how_tags_work" title="Permanent link">&para;</a></h3>
<p>Now let's take a look at how the search list interacts with WeeWX tags.
Let's start by looking at a simple example: station altitude, available
as the tag</p>
<div class="highlight"><pre><span></span><code>$station.altitude
</code></pre></div>
<p>As we saw in the previous section, Cheetah will run down the search
list, looking for an object with a key or attribute <code>station</code>. In
the default search list, WeeWX includes one such object, an instance of
the class <code>weewx.cheetahgenerator.Station</code>, which has an
attribute <code>station</code>, so it gets a hit on this object.</p>
<p>Cheetah will then try to evaluate the attribute <code>altitude</code> on
this object. Class <code>Station</code> has such an attribute, so Cheetah
evaluates it.</p>
<h4 id="return-value">Return value<a class="headerlink" href="#return-value" title="Permanent link">&para;</a></h4>
<p>What this attribute returns is not a raw value, say <code>700</code>, nor
even a string. Instead, it returns an instance of the class
<a href="../custom/appendix/#ValueHelper"><code>ValueHelper</code></a>, a special class defined in module
<code>weewx.units</code>. Internally, it holds not only the raw value, but
also references to the formats, labels, and conversion targets you
specified in your configuration file. Its job is to make sure that the
final output reflects these preferences. Cheetah doesn't know anything
about this class. What it needs, when it has finished evaluating the
expression <code>$station.altitude</code>, is a <em>string</em>. In order to
convert the <code>ValueHelper</code> it has in hand into a string, it does
what every other Python object does when faced with this problem: it
calls the special method
<a href="https://docs.python.org/3/reference/datamodel.html#object.__str__"><code>__str__</code></a>.
Class <code>ValueHelper</code> has a definition for this method. Evaluating
this function triggers the final steps in this process. Any necessary
unit conversions are done, then formatting occurs and, finally, a label
is attached. The result is a string something like</p>
<div class="example_output">
700 feet
</div>

<p>which is what Cheetah actually puts in the generated HTML file. This is
a good example of <em>lazy evaluation</em>. The tags gather all the information
they need, but don't do the final evaluation until the last final
moment, when the most context is understood. WeeWX uses this technique
extensively.</p>
<h3 id="A_slightly_more_complex_tag">A slightly more complex tag<a class="headerlink" href="#A_slightly_more_complex_tag" title="Permanent link">&para;</a></h3>
<p>Now let's look at a more complicated example, say the maximum
temperature since midnight:</p>
<div class="highlight"><pre><span></span><code>$day.outTemp.max
</code></pre></div>
<p>When this is evaluated by Cheetah, it actually produces a chain of
objects. At the top of this chain is class
<code>weewx.tags.TimeBinder</code>, an instance of which is included in the
default search list. Internally, this instance stores the time of the
desired report (usually the time of the last archive record), a cache to
the databases, a default data binding, as well as references to the
formatting and labelling options you have chosen.</p>
<p>This instance is examined by Cheetah to see if it has an attribute
<code>day</code>. It does and, when it is evaluated, it returns the next
class in the chain, an instance of <code>weewx.tags.TimespanBinder</code>.
In addition to all the other things contained in its parent
<code>TimeBinder</code>, class <code>TimespanBinder</code> adds the desired time
period, that is, the time span from midnight to the current time.</p>
<p>Cheetah then continues on down the chain and tries to find the next
attribute, <code>outTemp</code>. There is no such hard coded attribute (hard
coding all the conceivable different observation types would be
impossible!). Instead, class <code>TimespanBinder</code> defines the Python
special method <a href="https://docs.python.org/3/reference/datamodel.html#object.__getattr__">
<code>__getattr__</code></a>.
If Python cannot find a hard coded version of an attribute, and the
method <code>__getattr__</code> exists, it will try it. The definition
provided by <code>TimespanBinder</code> returns an instance of the next
class in the chain, <code>weewx.tags.ObservationBinder</code>, which not
only remembers all the previous stuff, but also adds the observation
type, <code>outTemp</code>.</p>
<p>Cheetah then tries to evaluate an attribute <code>max</code> of this class,
and the pattern repeats. Class <code>weewx.tags.ObservationBinder</code>
does not have an attribute <code>max</code>, but it does have a method
<code>__getattr__</code>. This method returns an instance of the next
class in the chain, class <code>AggTypeBinder</code>, which not only
remembers all the previous information, but adds the aggregation type,
<code>max</code>.</p>
<p>One final step needs to occur: Cheetah has an instance of
<code>AggTypeBinder</code> in hand, but what it really needs is a string to
put in the file being created from the template. It creates the string
by calling the method <code>__str__()</code> of <code>AggTypeBinder</code>.
Now, finally, the chain ends and everything comes together. The method
<code>__str__</code> triggers the actual calculation of the value, using
all the known parameters: the database binding to be hit, the time span
of interest, the observation type, and the type of aggregation, querying
the database as necessary. The database is not actually hit until the
last possible moment, after everything needed to do the evalation is
known.</p>
<p>Like our previous example, the results of the evaluation are then
packaged up in an instance of <code>ValueHelper</code>, which does the final
conversion to the desired units, formats the string, then adds a label.
The results, something like</p>
<div class="example_output">
12°C
</div>

<p>are put in the generated HTML file. As you can see, a lot of machinery
is hidden behind the deceptively simple expression
<code>$day.outTemp.max</code>!</p>
<h2 id="extending_the_list">Extending the list<a class="headerlink" href="#extending_the_list" title="Permanent link">&para;</a></h2>
<p>As mentioned, WeeWX comes with a number of objects already in the search
list, but you can extend it.</p>
<p>The general pattern is to create a new class that inherits from
<code>weewx.cheetahgenerator.SearchList</code>, which supplies the
functionality you need. You may or may not need to override its member
function <code>get_extension_list()</code>. If you do not, then a default is
supplied.</p>
<h3 id="adding-tag-seven_day">Adding tag <code>$seven_day</code><a class="headerlink" href="#adding-tag-seven_day" title="Permanent link">&para;</a></h3>
<p>Let's look at an example. The regular version of WeeWX offers
statistical summaries by day, week, month, year, rain year, and all
time. While WeeWX offers the tag <code>$week</code>, this is statistics
<em>since Sunday at midnight</em>. Suppose we would like to have statistics for
a full week, that is since midnight seven days ago.</p>
<p>This example is included in the distribution as
<code>examples/seven_day.py</code>. If you wish to use or modify it, first
copy it over to <code>user/seven_day.py</code>, then modify it there.
Otherwise, at the next upgrade, you will lose any changes you have made.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">weewx.cheetahgenerator</span> <span class="kn">import</span> <span class="n">SearchList</span>
<span class="kn">from</span> <span class="nn">weewx.tags</span> <span class="kn">import</span> <span class="n">TimespanBinder</span>
<span class="kn">from</span> <span class="nn">weeutil.weeutil</span> <span class="kn">import</span> <span class="n">TimeSpan</span>

<span class="k">class</span> <span class="nc">SevenDay</span><span class="p">(</span><span class="n">SearchList</span><span class="p">):</span>                                                  <span class="c1"># 1</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator</span><span class="p">):</span>                                           <span class="c1"># 2</span>
        <span class="n">SearchList</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_extension_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timespan</span><span class="p">,</span> <span class="n">db_lookup</span><span class="p">):</span>                       <span class="c1"># 3</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a search list extension with two additions.</span>

<span class="sd">        Parameters:</span>
<span class="sd">          timespan: An instance of weeutil.weeutil.TimeSpan. This will</span>
<span class="sd">                    hold the start and stop times of the domain of</span>
<span class="sd">                    valid times.</span>

<span class="sd">          db_lookup: This is a function that, given a data binding</span>
<span class="sd">                     as its only parameter, will return a database manager</span>
<span class="sd">                     object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Create a TimespanBinder object for the last seven days. First, calculate</span>
        <span class="c1"># the time at midnight, seven days ago. The variable week_dt will be an instance of</span>
        <span class="c1"># datetime.date.</span>
        <span class="n">week_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">timespan</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span> \
                  <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>                              <span class="c1"># 4</span>
        <span class="c1"># Convert it to unix epoch time:</span>
        <span class="n">week_ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">week_dt</span><span class="o">.</span><span class="n">timetuple</span><span class="p">())</span>                           <span class="c1"># 5</span>
        <span class="c1"># Form a TimespanBinder object, using the time span we just</span>
        <span class="c1"># calculated:</span>
        <span class="n">seven_day_stats</span> <span class="o">=</span> <span class="n">TimespanBinder</span><span class="p">(</span><span class="n">TimeSpan</span><span class="p">(</span><span class="n">week_ts</span><span class="p">,</span> <span class="n">timespan</span><span class="o">.</span><span class="n">stop</span><span class="p">),</span>
                                         <span class="n">db_lookup</span><span class="p">,</span>
                                         <span class="n">context</span><span class="o">=</span><span class="s1">&#39;week&#39;</span><span class="p">,</span>
                                         <span class="n">formatter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">formatter</span><span class="p">,</span>
                                         <span class="n">converter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">converter</span><span class="p">,</span>
                                         <span class="n">skin_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">skin_dict</span><span class="p">)</span> <span class="c1"># 6</span>

        <span class="c1"># Now create a small dictionary with the key &#39;seven_day&#39;:</span>
        <span class="n">search_list_extension</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;seven_day&#39;</span> <span class="p">:</span> <span class="n">seven_day_stats</span><span class="p">}</span>              <span class="c1"># 7</span>

        <span class="c1"># Finally, return our extension as a list:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">search_list_extension</span><span class="p">]</span>                                       <span class="c1"># 8</span>
</code></pre></div>
<p>Going through the example, line by line:</p>
<ol>
<li>Create a new class called <code>SevenDay</code>, which will inherit from
    class <code>SearchList</code>. All search list extensions must inherit
    from this class.</li>
<li>Create an initializer for our new class. In this case, the
    initializer is not really necessary and does nothing except pass its
    only parameter, <code>generator</code>, a reference to the calling
    generator, on to its superclass, <code>SearchList</code>, which will
    then store it in <code>self</code>. Nevertheless, we include the
    initializer in case you wish to modify it.</li>
<li>Override member function <code>get_extension_list()</code>. This
    function will be called when the generator is ready to accept your
    new search list extension. The parameters that will be passed in
    are:<ul>
<li><code>self</code> Python's way of indicating the instance we are
    working with;</li>
<li><code>timespan</code> An instance of the utility class
    <code>TimeSpan</code>. This will contain the valid start and ending
    times used by the template. Normally, this is all valid times,
    but if your template appears under one of the
    <a href="/custom/cheetah/#specifying-template-files">"Summary By"</a> sections in the
    <code>[CheetahGenerator]</code> section of <code>skin.conf</code>, then
    it will contain the timespan of that time period.</li>
<li><code>db_lookup</code> This is a function supplied by the generator.
    It takes a single argument, a name of a binding. When called, it
    will return an instance of the database manager class for that
    binding. The default for the function is whatever binding you
    set with the option <code>data_binding</code> for this report,
    usually <code>wx_binding</code>.</li>
</ul>
</li>
<li>The object <code>timespan</code> holds the domain of all valid times for
    the template, but in order to calculate statistics for the last
    seven days, we need not the earliest valid time, but the time at
    midnight seven days ago. So, we do a little Python date arithmetic
    to calculate this. The object <code>week_dt</code> will be an instance
    of <code>datetime.date</code>.</li>
<li>We convert it to unix epoch time and assign it to variable
    <code>week_ts</code>.</li>
<li>The class <code>TimespanBinder</code> represents a statistical
    calculation over a time period. We have <a href="#A_slightly_more_complex_tag">already met
    it</a> in the introduction. In our case, we will set it up to represent
    the statistics over the last seven days. The class takes 6
    parameters.<ul>
<li>The first is the timespan over which the calculation is to be
    done, which, in our case, is the last seven days. In step 5, we
    calculated the start of the seven days. The end is "now", that
    is, the end of the reporting period. This is given by the end
    point of <code>timespan</code>, <code>timespan.stop</code>.</li>
<li>The second, <code>db_lookup</code>, is the database lookup function
    to be used. We simply pass in <code>db_lookup</code>.</li>
<li>The third, <code>context</code>, is the time <em>context</em> to be used
    when formatting times. The set of possible choices is given by
    sub-section <a href="/custom/options_ref/#Units_TimeFormats"><code>[[TimeFormats]]</code></a>
    in the configuration file. Our new tag, <code>$seven_day</code>
    is pretty similar to <code>$week</code>, so we will just use
    <code>'week'</code>, indicating that we want a time format that is
    suitable for a week-long period.</li>
<li>The fourth, <code>formatter</code>, should be an instance of class
    <code>weewx.units.Formatter</code>, which contains information about
    how the results should be formatted. We just pass in the
    formatter set up by the generator,
    <code>self.generator.formatter</code>.</li>
<li>The fifth, <code>converter</code>, should be an instance of
    <code>weewx.units.Converter</code>, which contains information about
    the target units (<em>e.g.</em>, <code>degree_C</code>) that are to be
    used. Again, we just pass in the instance set up by the
    generator, <code>self.generator.converter</code>.</li>
<li>The sixth, <code>skin_dict</code>, is an instance of
    <code>configobj.ConfigObj</code>, and contains the contents of the
    skin configuration file. We pass it on in order to allow
    aggregations that need information from the file, such as
    heating and cooling degree-days.</li>
</ul>
</li>
<li>Create a small dictionary with a single key, <code>seven_day</code>,
    whose value will be the <code>TimespanBinder</code> that we just
    constructed.</li>
<li>Return the dictionary in a list</li>
</ol>
<p>The final step that we need to do is to tell the template engine where
to find our extension. You do that by going into the skin configuration
file, <code>skin.conf</code>, and adding the option
<code>search_list_extensions</code> with our new extension. When you're
done, it will look something like this:</p>
<div class="highlight"><pre><span></span><code><span class="k">[CheetahGenerator]</span>
<span class="w">    </span><span class="c1"># This section is used by the generator CheetahGenerator, and specifies</span>
<span class="w">    </span><span class="c1"># which files are to be generated from which template.</span>

<span class="w">    </span><span class="c1"># Possible encodings include &#39;html_entities&#39;, &#39;strict_ascii&#39;, &#39;normalized_ascii&#39;,</span>
<span class="w">    </span><span class="c1"># as well as those listed in https://docs.python.org/3/library/codecs.html#standard-encodings</span>
<span class="w">    </span><span class="na">encoding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">html_entities</span>
<span class="hll"><span class="w">    </span><span class="na">search_list_extensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">user.seven_day.SevenDay</span>
</span>
<span class="w">    </span><span class="k">[[SummaryByMonth]]</span>
<span class="w">    </span><span class="na">...</span>
</code></pre></div>
<p>Our addition has been <mark>highlighted</mark>. Note that it is in the
section <code>[CheetahGenerator]</code>.</p>
<p>Now, if the Cheetah engine encounters the tag <code>$seven_day</code>, it
will scan the search list, looking for an attribute or key that matches
<code>seven_day</code>. When it gets to the little dictionary we provided,
it will find a matching key, allowing it to retrieve the appropriate
<code>TimespanBinder</code> object.</p>
<p>With this approach, you can now include "seven day" statistics in your
HTML templates:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">table</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Maximum temperature over the last seven days:<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>$seven_day.outTemp.max<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Minimum temperature over the last seven days:<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>$seven_day.outTemp.min<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Rain over the last seven days:<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
<span class="hll">        <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>$seven_day.rain.sum<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
</span>    <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
</code></pre></div>
<p>We put our addition <code>stats.py</code> in the "user" directory, which is automatically
included by WeeWX in the Python path. 
However, if you put the file somewhere else, you may have to specify its
location with the environment variable
<a href="https://docs.python.org/3/using/cmdline.html#envvar-PYTHONPATH"><code>PYTHONPATH</code></a>
when you start WeeWX:</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">PYTHONPATH</span><span class="o">=</span>/home/me/secret_location
</code></pre></div>
<h3 id="adding-tag-colorize">Adding tag <code>$colorize</code><a class="headerlink" href="#adding-tag-colorize" title="Permanent link">&para;</a></h3>
<p>Let's look at another example. This one will allow you to supply a
background color, depending on the temperature. For example, to colorize
an HTML table cell:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">table</span><span class="p">&gt;</span>

    ...

  <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Outside temperature<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
<span class="hll">    <span class="p">&lt;</span><span class="nt">td</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;background-color:$colorize($current.outTemp.raw)&quot;</span><span class="p">&gt;</span>$current.outTemp<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
</span>  <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>

    ...

<span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
</code></pre></div>
<p>The highlighted expression will return a color, depending on the value
of its argument. For example, if the temperature was 30.9ºF, then the
output might look like:</p>
<table>
    <tr>
        <td>Outside temperature</td>
        <td style="background-color:violet">30.9&#176;F</td>
    </tr>
</table>

<h4 id="a-very-simple-implementation">A very simple implementation<a class="headerlink" href="#a-very-simple-implementation" title="Permanent link">&para;</a></h4>
<p>We will start with a very simple version. The code can be found in
<code>examples/colorize/colorize_1.py</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">weewx.cheetahgenerator</span> <span class="kn">import</span> <span class="n">SearchList</span>

<span class="k">class</span> <span class="nc">Colorize</span><span class="p">(</span><span class="n">SearchList</span><span class="p">):</span>                                          <span class="c1"># 1</span>

    <span class="k">def</span> <span class="nf">colorize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t_c</span><span class="p">):</span>                                         <span class="c1"># 2</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Choose a color on the basis of temperature</span>

<span class="sd">        Args:</span>
<span class="sd">            t_c (float): The temperature in degrees Celsius</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: A color string</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">t_c</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>                                              <span class="c1"># 3</span>
            <span class="k">return</span> <span class="s2">&quot;#00000000&quot;</span>
        <span class="k">elif</span> <span class="n">t_c</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">10</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;magenta&quot;</span>
        <span class="k">elif</span> <span class="n">t_c</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;violet&quot;</span>
        <span class="k">elif</span> <span class="n">t_c</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;lavender&quot;</span>
        <span class="k">elif</span> <span class="n">t_c</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;mocassin&quot;</span>
        <span class="k">elif</span> <span class="n">t_c</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;yellow&quot;</span>
        <span class="k">elif</span> <span class="n">t_c</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;coral&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;tomato&quot;</span>
</code></pre></div>
<p>The first thing that's striking about this version is just how simple
an SLE can be: just one class with a single function. Let's go through
the implementation line-by-line.</p>
<ol>
<li>
<p>Just like the first example, all search list extensions inherit from
    <code>weewx.cheetahgenerator.SearchList</code></p>
</li>
<li>
<p>The class defines a single function, <code>colorize()</code>, with a
    single argument that must be of type <code>float</code>.</p>
<p>Unlike the first example, notice how we do not define an
initializer, <code>__init__()</code>, and, instead, rely on our
superclass to do the initialization.</p>
</li>
<li>
<p>The function relies on a big if/else statement to pick a color on
    the basis of the temperature value. Note how it starts by checking
    whether the value could be Python <code>None</code>. WeeWX uses <code>None</code> to represent
    missing or invalid data. One must be always vigilant in guarding
    against a <code>None</code> value. If <code>None</code> is found, then the color <code>#00000000</code> is
    returned, which is transparent and will have no effect.</p>
</li>
</ol>
<h5 id="registering">Registering<a class="headerlink" href="#registering" title="Permanent link">&para;</a></h5>
<p>As before, we must register our extension with the Cheetah engine. We do
this by copying the extension to the user directory, then adding its
location to option <code>search_list_extensions</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">[CheetahGenerator]</span>
<span class="w">    </span><span class="na">...</span>
<span class="w">    </span><span class="na">search_list_extensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">user.colorize_1.Colorize</span>
<span class="w">    </span><span class="na">...</span>
</code></pre></div>
<h5 id="where-is-get_extension_list">Where is <code>get_extension_list()</code>?<a class="headerlink" href="#where-is-get_extension_list" title="Permanent link">&para;</a></h5>
<p>You might wonder, "What happened to the member function
<code>get_extension_list()</code>? We needed it in the first example; why
not now?" The answer is that we are inheriting from, and relying on,
the version in the superclass <code>SearchList</code>, which looks like
this:</p>
<div class="highlight"><pre><span></span><code>    <span class="k">def</span> <span class="nf">get_extension_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timespan</span><span class="p">,</span> <span class="n">db_lookup</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span>
</code></pre></div>
<p>This returns a list, with itself (an instance of class
<code>Colorize</code>) as the only member.</p>
<p>How do we know whether to include an instance of
<code>get_extension_list()</code>? Why did we include a version in the first
example, but not in the second?</p>
<p>The answer is that many extensions, including <code>$seven_day</code>, need
information that can only be known when the template is being evaluated.
In the case of <code>$seven_day</code>, this was which database binding to
use, which will determine the results of the database query done in its
implementation. This information is not known until
<code>get_extension_list()</code> is called, which is just before template
evaluation.</p>
<p>By constrast, <code>$colorize()</code> is pure static: it doesn't use the
database at all, and everything it needs it can get from its single
function argument. So, it has no need for the information in
<code>get_extension_list()</code>.</p>
<h5 id="review">Review<a class="headerlink" href="#review" title="Permanent link">&para;</a></h5>
<p>Let's review the whole process. When the WeeWX Cheetah generator starts
up to evaluate a template, it first creates a search list. It does this
by calling <code>get_extension_list()</code> for each SLE that has been
registered with it. In our case, this will cause the function above to
put an instance of <code>Colorize</code> in the search list &mdash; we don't
have to do anything to make this happen.</p>
<p>When the engine starts to process the template, it will eventually come
to</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">td</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;background-color:$colorize($current.outTemp.raw)&quot;</span><span class="p">&gt;</span>$current.outTemp<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
</code></pre></div>
<p>It needs to evaluate the expression
<code>$colorize($current.outTemp.raw)</code>, so it starts scanning the
search list looking for something with an attribute or key
<code>colorize</code>. When it comes to our instance of <code>Colorize</code> it
gets a hit because, in Python, member functions are implemented as
attributes. The Cheetah engine knows to call it as a function because of
the parenthesis that follow the name. The engine passes in the value of
<code>$current.outTemp.raw</code> as the sole argument, where it appears
under the name <code>t_c</code>.</p>
<p>As described above, the function <code>colorize()</code> then uses the
argument to choose an appropriate color, returning it as a string.</p>
<h5 id="limitation">Limitation<a class="headerlink" href="#limitation" title="Permanent link">&para;</a></h5>
<p>This example has an obvious limitation: the argument to
<code>$colorize()</code> must be in degrees Celsius. We can guard against
passing in the wrong unit by always converting to Celsius first:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">td</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;background-color:$colorize($current.outTemp.degree_C.raw)&quot;</span><span class="p">&gt;</span>$current.outTemp<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
</code></pre></div>
<p>but the user would have to remember to do this every time
<code>colorize()</code> is called. The next version gets around this
limitation.</p>
<h4 id="a-slightly-better-version">A slightly better version<a class="headerlink" href="#a-slightly-better-version" title="Permanent link">&para;</a></h4>
<p>Here's an improved version that can handle an argument that uses any
unit, not just degrees Celsius. The code can be found in
<code>examples/colorize/colorize_2.py</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">weewx.units</span>
<span class="kn">from</span> <span class="nn">weewx.cheetahgenerator</span> <span class="kn">import</span> <span class="n">SearchList</span>

<span class="k">class</span> <span class="nc">Colorize</span><span class="p">(</span><span class="n">SearchList</span><span class="p">):</span>                                          <span class="c1"># 1</span>

    <span class="k">def</span> <span class="nf">colorize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value_vh</span><span class="p">):</span>                                    <span class="c1"># 2</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Choose a color string on the basis of a temperature value&quot;&quot;&quot;</span>

        <span class="c1"># Extract the ValueTuple part out of the ValueHelper</span>
        <span class="n">value_vt</span> <span class="o">=</span> <span class="n">value_vh</span><span class="o">.</span><span class="n">value_t</span>                                  <span class="c1"># 3</span>

        <span class="c1"># Convert to Celsius:</span>
        <span class="n">t_celsius</span> <span class="o">=</span> <span class="n">weewx</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">value_vt</span><span class="p">,</span> <span class="s1">&#39;degree_C&#39;</span><span class="p">)</span>        <span class="c1"># 4</span>

        <span class="c1"># The variable &quot;t_celsius&quot; is a ValueTuple. Get just the value:</span>
        <span class="n">t_c</span> <span class="o">=</span> <span class="n">t_celsius</span><span class="o">.</span><span class="n">value</span>                                        <span class="c1"># 5</span>

        <span class="c1"># Pick a color based on the temperature</span>
        <span class="k">if</span> <span class="n">t_c</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>                                              <span class="c1"># 6</span>
            <span class="k">return</span> <span class="s2">&quot;#00000000&quot;</span>
        <span class="k">elif</span> <span class="n">t_c</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">10</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;magenta&quot;</span>
        <span class="k">elif</span> <span class="n">t_c</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;violet&quot;</span>
        <span class="k">elif</span> <span class="n">t_c</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;lavender&quot;</span>
        <span class="k">elif</span> <span class="n">t_c</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;mocassin&quot;</span>
        <span class="k">elif</span> <span class="n">t_c</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;yellow&quot;</span>
        <span class="k">elif</span> <span class="n">t_c</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;coral&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;tomato&quot;</span>
</code></pre></div>
<p>Going through the example, line by line:</p>
<ol>
<li>
<p>Just like the other examples, we must inherit from
    <code>weewx.cheetahgenerator.SearchList</code>.</p>
</li>
<li>
<p>However, in this example, notice that the argument to
    <code>colorize()</code> is an instance of class
    <a href="../custom/appendix/#ValueHelper"><code>ValueHelper</code></a>, instead of a
    simple float.</p>
<p>As before, we do not define an initializer, <code>__init__()</code>,
and, instead, rely on our superclass to do the initialization.</p>
</li>
<li>
<p>The argument <code>value_vh</code> will contain many things, including
    formatting and preferred units, but, for now, we are only interested
    in the <a href="../custom/appendix/#ValueTuple"><code>ValueTuple</code></a> contained
    within, which can be extracted with the attribute <code>value_t</code>.</p>
</li>
<li>
<p>The variable <code>value_vt</code> could be in any unit that measures
    temperature. Our code needs Celsius, so we convert to Celsius using
    the convenience function <code>weewx.units.convert()</code>. The results
    will be a new <code>ValueTuple</code>, this time in Celsius.</p>
</li>
<li>
<p>We need just the temperature value, and not the other things in a
    <code>ValueTuple</code>, so extract it using the attribute
    <code>value</code>. The results will be a simple instance of
    <code>float</code> or, possibly, Python <code>None</code>.</p>
</li>
<li>
<p>Finally, we need a big if/else statement to choose which color to
    return, while making sure to test for <code>None</code>.</p>
</li>
</ol>
<p>This version uses a <code>ValueHelper</code> as an argument instead of a
float. How do we call it? Here's an example:</p>
<div class="highlight"><pre><span></span><code>&lt;table&gt;

    ...

  &lt;tr&gt;
    &lt;td&gt;Outside temperature&lt;/td&gt;
<span class="hll">    &lt;td style=&quot;background-color:$colorize($current.outTemp)&quot;&gt;$current.outTemp&lt;/td&gt;
</span>  &lt;/tr&gt;

    ...

&lt;/table&gt;
</code></pre></div>
<p>This time, we call the function with a simple <code>$current.outTemp</code>
(without the <code>.raw</code> suffix), which is actually an instance of
class <code>ValueHelper</code>. When we met this class earlier, the Cheetah engine needed a string to
put in the template, so it called the special member function
<code>__str__()</code>. However, in this case, the results are going to
be used as an argument to a function, not as a string, so the engine
simply passes in the <code>ValueHelper</code> unchanged to
<code>colorize()</code>, where it appears as argument <code>value_vh</code>.</p>
<p>Our new version is better than the original because it can take a
temperature in any unit, not just Celsius. However, it can still only
handle temperature values and, even then, the color bands are still
hardwired in. Our next version will remove these limitations.</p>
<h4 id="a-more-sophisticated-version">A more sophisticated version<a class="headerlink" href="#a-more-sophisticated-version" title="Permanent link">&para;</a></h4>
<p>Rather than hardwire in the values and observation type, in this version
we will retrieve them from the skin configuration file,
<code>skin.conf</code>. Here's what a typical configuration might look like
for this version:</p>
<div class="highlight"><pre><span></span><code><span class="na">[Colorize]                      # 1</span>
<span class="w">    </span><span class="na">[[group_temperature]]       # 2</span>
<span class="w">        </span><span class="na">unit_system</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">metricwx</span><span class="w">  </span><span class="c1"># 3</span>
<span class="w">        </span><span class="na">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">tomato</span><span class="w">        </span><span class="c1"># 4</span>
<span class="w">        </span><span class="na">None</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">lightgray</span><span class="w">        </span><span class="c1"># 5</span>
<span class="w">        </span><span class="na">[[[upper_bounds]]]      # 6</span>
<span class="w">            </span><span class="na">-10</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">magenta</span><span class="w">       </span><span class="c1"># 7</span>
<span class="w">            </span><span class="na">0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">violet</span><span class="w">          </span><span class="c1"># 8</span>
<span class="w">            </span><span class="na">10</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">lavender</span>
<span class="w">            </span><span class="na">20</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">mocassin</span>
<span class="w">            </span><span class="na">30</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">yellow</span>
<span class="w">            </span><span class="na">40</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">coral</span>
<span class="w">    </span><span class="na">[[group_uv]]                # 9</span>
<span class="w">        </span><span class="na">unit_system</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">metricwx</span>
<span class="w">        </span><span class="na">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">darkviolet</span>
<span class="w">        </span><span class="k">[[[upper_bounds]]]</span>
<span class="w">            </span><span class="na">2.4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">limegreen</span>
<span class="w">            </span><span class="na">5.4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">yellow</span>
<span class="w">            </span><span class="na">7.4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">orange</span>
<span class="w">            </span><span class="na">10.4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">red</span>
</code></pre></div>
<p>Here's what the various lines in the configuration stanza mean:</p>
<ol>
<li>All of the configuration information needed by the SLE
    <code>Colorize</code> can be found in a stanza with the heading
    <code>[Colorize]</code>. Linking facility with a stanza of the same
    name is a very common pattern in WeeWX.</li>
<li>We need a separate color table for each unit group that we are going
    to support. This is the start of the table for unit group
    <code>group_temperature</code>.</li>
<li>We need to specify what unit system will be used by the temperature
    color table. In this example, we are using <code>metricwx</code>.</li>
<li>In case we do not find a value in the table, we need a default. We
    will use the color <code>tomato</code>.</li>
<li>In case the value is Python <code>None</code>, return the color given by option
    <code>None</code>. We will use <code>lightgray</code>.</li>
<li>The sub-subsecction <code>[[[upper_bounds]]]</code> lists the
    upper (max) value of each of the color bands.</li>
<li>The first color band (magenta) is used for temperatures less than or
    equal to -10°C.</li>
<li>The second band (violet) is for temperatures greater than -10°C and
    less than or equal to 0°C. And so on.</li>
<li>The next subsection, <code>[[group_uv]]</code>, is very similar to
    the one for <code>group_temperature</code>, except the values are for
    bands of the UV index.</li>
</ol>
<p>Although <code>[Colorize]</code> is in <code>skin.conf</code>, there is
nothing special about it, and it can be overridden in
<code>weewx.conf</code>, just like any other configuration information.</p>
<h5 id="annotated-code">Annotated code<a class="headerlink" href="#annotated-code" title="Permanent link">&para;</a></h5>
<p>Here's the alternative version of <code>colorize()</code>, which will use
the values in the configuration file. It can also be found in
<code>examples/colorize/colorize_3.py</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">weewx.units</span>
<span class="kn">from</span> <span class="nn">weewx.cheetahgenerator</span> <span class="kn">import</span> <span class="n">SearchList</span>

<span class="k">class</span> <span class="nc">Colorize</span><span class="p">(</span><span class="n">SearchList</span><span class="p">):</span>                                               <span class="c1"># 1</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator</span><span class="p">):</span>                                        <span class="c1"># 2</span>
        <span class="n">SearchList</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color_tables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">skin_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Colorize&#39;</span><span class="p">,</span> <span class="p">{})</span>

    <span class="k">def</span> <span class="nf">colorize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value_vh</span><span class="p">):</span>

        <span class="c1"># Get the ValueTuple and unit group from the incoming ValueHelper</span>
        <span class="n">value_vt</span> <span class="o">=</span> <span class="n">value_vh</span><span class="o">.</span><span class="n">value_t</span>                                       <span class="c1"># 3</span>
        <span class="n">unit_group</span> <span class="o">=</span> <span class="n">value_vt</span><span class="o">.</span><span class="n">group</span>                                       <span class="c1"># 4</span>

        <span class="c1"># Make sure unit_group is in the color table, and that the table</span>
        <span class="c1"># specifies a unit system.</span>
        <span class="k">if</span> <span class="n">unit_group</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_tables</span> \
                <span class="ow">or</span> <span class="s1">&#39;unit_system&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_tables</span><span class="p">[</span><span class="n">unit_group</span><span class="p">]:</span>    <span class="c1"># 5</span>
            <span class="k">return</span> <span class="s2">&quot;#00000000&quot;</span>

        <span class="c1"># Convert the value to the same unit used by the color table:</span>
        <span class="n">unit_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_tables</span><span class="p">[</span><span class="n">unit_group</span><span class="p">][</span><span class="s1">&#39;unit_system&#39;</span><span class="p">]</span>        <span class="c1"># 6</span>
        <span class="n">converted_vt</span> <span class="o">=</span> <span class="n">weewx</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">convertStdName</span><span class="p">(</span><span class="n">value_vt</span><span class="p">,</span> <span class="n">unit_system</span><span class="p">)</span>  <span class="c1"># 7</span>

        <span class="c1"># Check for a value of None</span>
        <span class="k">if</span> <span class="n">converted_vt</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>                                    <span class="c1"># 8</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_tables</span><span class="p">[</span><span class="n">unit_group</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span> \
                   <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_tables</span><span class="p">[</span><span class="n">unit_group</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s2">&quot;#00000000&quot;</span><span class="p">)</span>

        <span class="c1"># Search for the value in the color table:</span>
        <span class="k">for</span> <span class="n">upper_bound</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_tables</span><span class="p">[</span><span class="n">unit_group</span><span class="p">][</span><span class="s1">&#39;upper_bounds&#39;</span><span class="p">]:</span> <span class="c1"># 9</span>
            <span class="k">if</span> <span class="n">converted_vt</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;=</span> <span class="nb">float</span><span class="p">(</span><span class="n">upper_bound</span><span class="p">):</span>                  <span class="c1"># 10</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_tables</span><span class="p">[</span><span class="n">unit_group</span><span class="p">][</span><span class="s1">&#39;upper_bounds&#39;</span><span class="p">][</span><span class="n">upper_bound</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_tables</span><span class="p">[</span><span class="n">unit_group</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="s2">&quot;#00000000&quot;</span><span class="p">)</span>  <span class="c1"># 11</span>
</code></pre></div>
<ol>
<li>
<p>As before, our class must inherit from <code>SearchList</code>.</p>
</li>
<li>
<p>In this version, we supply an initializer because we are going to do
    some work in it: extract our color table out of the skin
    configuration dictionary. In case the user neglects to include a
    <code>[Colorize]</code> section, we substitute an empty dictionary.</p>
</li>
<li>
<p>As before, we extract the <code>ValueTuple</code> part out of the
    incoming <code>ValueHelper</code> using the attribute <code>value_t</code>.</p>
</li>
<li>
<p>Retrieve the unit group used by the incoming argument. This will be
    something like "group_temperature".</p>
</li>
<li>
<p>What if the user is requesting a color for a unit group that we
    don't know anything about? We must check that the unit group is in
    our color table. We must also check that a unit system has been
    supplied for the color table. If either of these checks fail, then
    return the color <code>#00000000</code>, which will have no effect in
    setting a background color.</p>
</li>
<li>
<p>Thanks to the checks we did in step 5, we know that this line will
    not raise a <code>KeyError</code> exception. Get the unit system used by
    the color table for this unit group. It will be something like
    'US', 'metric', or 'metricwx'.</p>
</li>
<li>
<p>Convert the incoming value, so it uses the same units as the color
    table.</p>
</li>
<li>
<p>We must always be vigilant for values of Python None! The expression</p>
<div class="highlight"><pre><span></span><code><span class="bp">self</span><span class="o">.</span><span class="n">color_tables</span><span class="p">[</span><span class="n">unit_group</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_tables</span><span class="p">[</span><span class="n">unit_group</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s2">&quot;#00000000&quot;</span><span class="p">)</span>
</code></pre></div>
<p>is just a trick to allow us to accept either "<code>none</code>" or
"<code>None</code>" in the configuration file. If neither is present,
then we return the color <code>#00000000</code>, which will have no
effect.</p>
</li>
<li>
<p>Now start searching the color table to find a band that is less than
    or equal to the value we have in hand.</p>
</li>
<li>
<p>Two details to note.</p>
<p>First, the variable <code>converted_vt</code> is a <code>ValueTuple</code>.
We need the raw value in order to do the comparison. We get this
through attribute <code>.value</code>.</p>
<p>Second, WeeWX uses the utility <code>ConfigObj</code> to read
configuration files. When <code>ConfigObj</code> returns its results,
the values will be <em>strings</em>. We must convert these to floats before
doing the comparison. You must be constantly vigilant about this
when working with configuration information.</p>
<p>If we find a band with an upper bound greater than our value, we
have a hit. Return the corresponding color.</p>
</li>
<li>
<p>If we make it all the way through the table without a hit, then we
    must have a value greater than anything in the table. Return the
    default, or the color <code>#00000000</code> if there is no default.</p>
</li>
</ol>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright © 2009-2023 Thomas Keffer and Matthew Wall, all rights reserved
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.tracking", "navigation.indexes", "navigation.top", "toc.follow", "search.highlight", "search.share", "search.suggest"], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.fac441b0.min.js"></script>
      
    
  </body>
</html>